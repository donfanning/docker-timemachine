#!/bin/bash

set -e

if [[ $# -lt 2 ]]; then
  echo "Usage: add-user USERNAME MOUNT_POINT [VOL_SIZE_MB]"
  exit 1
fi


# Create mountpoint
mkdir -p $2
chown -R $1:root $2

# Add config to timemachine
  echo "
[${1}]
    path = ${2}
    time machine = yes
    valid users = ${1}" >> /etc/afp.conf

if [[ $# -eq 3 ]]; then
  echo "
    vol size limit = ${3}" >> /etc/afp.conf
fi

pkill -HUP afpd
